# HNSW（多层次图）

## 原理
> 1. 基于图的近似搜索算法，原理类似于跳表，对标的物构建多层次相似图，类似跳表，高层次下能够跳跃很多节点，两节点间能够通过少量跳跃到达，同时对于相似节点，又有着高内聚的特点，因此能够基于高层的稀疏连接下，快速定位目标区域，同时基于底层的稠密连接，精细搜索最近邻节点。
> 2. 搜索过程：类似于跳表，自上而下搜索，从最高层入口点开始，逐层细化，在每一层执行贪婪搜索，找到离查询点最近的节点，作为下一层的入口。在底层精确搜索，在底层使用动态候选列表（如优先队列，将邻居加入，优先最近的邻居扩展），逐步扩展邻居，直到找到最近邻。
> 3. 构建过程：对新插入节点，随机确定最高层数，然后逐层连接，从最高层向下，每层找到最近邻节点，建立新节点与这些邻居的双向连接，同时修剪多余边（保持每个节点的出边数不超过M，防止过度稠密，可基于优先队列，贪婪搜索距离最近的邻居，建立连接后，更新邻居连接的点，删除其最远邻居连接）。
> 4. 关键参数：最大双向连接邻居数M（平衡搜索速度与精度）、插入时候选池大小efConstruction（影响构建质量和内存消耗）、搜索时候选池大小efSearch（决定召回率和计算开销）、层数概率分布（影响层数分布，高层的稠密度）；
> 5. 优点：高召回率（当 efSearch 较大接近暴搜精度）、低延迟（log N级）、适应高维数据；缺点：内存占用高，参数敏感；


[返回主页](../../README.md)
